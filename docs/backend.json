{
  "entities": {
    "Transaction": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Transaction",
      "type": "object",
      "description": "Represents a credit card transaction.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the transaction."
        },
        "amount": {
          "type": "number",
          "description": "Transaction amount in INR (Rupees)."
        },
        "time": {
          "type": "string",
          "description": "Timestamp of the transaction.",
          "format": "date-time"
        },
        "location": {
          "type": "string",
          "description": "Location of the transaction."
        },
        "merchantDetails": {
          "type": "string",
          "description": "Details of the merchant involved in the transaction."
        },
        "isFraudulent": {
          "type": "boolean",
          "description": "Indicates whether the transaction is predicted as fraudulent."
        },
        "confidenceScore": {
          "type": "number",
          "description": "Confidence score of the fraud prediction (0-1)."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Transaction)"
        }
      },
      "required": [
        "id",
        "amount",
        "time",
        "location",
        "merchantDetails",
        "isFraudulent",
        "confidenceScore",
        "userId"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the fraud detection system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "username": {
          "type": "string",
          "description": "Username of the user."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        }
      },
      "required": [
        "id",
        "username",
        "email"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information.  Path-based ownership for private user data.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/transactions/{transactionId}",
        "definition": {
          "entityName": "Transaction",
          "schema": {
            "$ref": "#/backend/entities/Transaction"
          },
          "description": "Stores transaction data associated with a specific user. Includes denormalized 'userId' for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "transactionId",
              "description": "The unique identifier for the transaction."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to ensure security, scalability, and ease of debugging, following the principles of Authorization Independence, Clarity of Intent, DBAC, and QAPs. User data and transaction data are segregated into separate collections to maintain a homogeneous security posture. Transactions are stored as subcollections of users to establish clear ownership. The `userId` field within each transaction document denormalizes the user-transaction relationship, which enforces Authorization Independence, avoiding the need for `get()` calls in security rules to validate user ownership. This setup efficiently supports list operations (QAPs) by allowing targeted queries for transactions associated with a specific user. Hierarchical paths are used to establish and maintain clear ownership of the resources. This also keeps all of a user's transactions together, while still allowing easy access to all users."
  }
}